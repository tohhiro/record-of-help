"use strict";(self.webpackChunkrecord_of_help=self.webpackChunkrecord_of_help||[]).push([[322],{"./app/(feature)/form/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const ErrorBoundaryContext=(0,react.createContext)(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends react.Component{constructor(props){super(props),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(error){return{didCatch:!0,error}}resetErrorBoundary(){const{error}=this.state;if(null!==error){for(var _this$props$onReset,_this$props,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];null===(_this$props$onReset=(_this$props=this.props).onReset)||void 0===_this$props$onReset||_this$props$onReset.call(_this$props,{args,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(error,info){var _this$props$onError,_this$props2;null===(_this$props$onError=(_this$props2=this.props).onError)||void 0===_this$props$onError||_this$props$onError.call(_this$props2,error,info)}componentDidUpdate(prevProps,prevState){const{didCatch}=this.state,{resetKeys}=this.props;var _this$props$onReset2,_this$props3;didCatch&&null!==prevState.error&&function hasArrayChanged(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.length!==b.length||a.some(((item,index)=>!Object.is(item,b[index])))}(prevProps.resetKeys,resetKeys)&&(null===(_this$props$onReset2=(_this$props3=this.props).onReset)||void 0===_this$props$onReset2||_this$props$onReset2.call(_this$props3,{next:resetKeys,prev:prevProps.resetKeys,reason:"keys"}),this.setState(initialState))}render(){const{children,fallbackRender,FallbackComponent,fallback}=this.props,{didCatch,error}=this.state;let childToRender=children;if(didCatch){const props={error,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof fallbackRender)childToRender=fallbackRender(props);else if(FallbackComponent)childToRender=(0,react.createElement)(FallbackComponent,props);else{if(null!==fallback&&!(0,react.isValidElement)(fallback))throw error;childToRender=fallback}}return(0,react.createElement)(ErrorBoundaryContext.Provider,{value:{didCatch,error,resetErrorBoundary:this.resetErrorBoundary}},childToRender)}}var navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),index_esm=__webpack_require__("./node_modules/react-hook-form/dist/index.esm.mjs"),zod=__webpack_require__("./node_modules/@hookform/resolvers/zod/dist/zod.mjs"),lib=__webpack_require__("./node_modules/zod/lib/index.mjs");const validationSchema=lib.z.object({person:lib.z.string().min(1,"どちらかを選択してください"),items:lib.z.object({helps:lib.z.array(lib.z.string()).min(1,"1つ以上選択してください"),comments:lib.z.string().nullable()}).refine((({helps,comments})=>!helps.includes("special,50")||(!!(comments&&comments.trim().length>0)||void 0)),{path:["comments"],message:"スペシャルはコメントしてね"})});var Button=__webpack_require__("./app/components/Button/index.tsx"),Radio=__webpack_require__("./app/components/Radio/index.tsx"),Textarea=__webpack_require__("./app/components/Textarea/index.tsx");var supabase=__webpack_require__("./app/libs/supabase.ts");var PricesList=__webpack_require__("./app/(feature)/form/components/PricesList/index.tsx");function Page(){var _errors_items,_errors_items1;const[isSubmitting,isSetSubmitting]=(0,react.useState)("primary"),[isClient,setIsClient]=(0,react.useState)(!1);(0,react.useEffect)((()=>{setIsClient(!0)}),[]);const post={postHelp:async args=>{const{data,error}=await supabase.N.from("raws_data").insert([args]);return{data,error}}},router=(0,navigation.useRouter)(),{register,formState:{errors,isDirty},handleSubmit,control}=(0,index_esm.mN)({mode:"onChange",resolver:(0,zod.u)(validationSchema)});return(isDirty=>{const handleBeforeunload=e=>{e.preventDefault()},handleClick=event=>{const targetElement=event.target;isDirty&&"A"===targetElement.tagName&&(window.confirm("ページを離れても良いですか？")||(event.preventDefault(),event.stopPropagation()))};(0,react.useEffect)((()=>{if(isDirty)return window.addEventListener("beforeunload",handleBeforeunload),window.addEventListener("click",handleClick,!0),()=>{window.removeEventListener("beforeunload",handleBeforeunload),window.removeEventListener("click",handleClick,!0)}}),[isDirty])})(isDirty),isClient&&(0,jsx_runtime.jsx)("div",{className:"w-100  h-200 m-10 text-center",children:(0,jsx_runtime.jsxs)("form",{onSubmit:handleSubmit((async data=>{var _res_error;const helpsData=(data=>data.reduce(((acc,help)=>{const tmp=help.split(",");return{...acc,[tmp[0]]:Number(tmp[1])}}),{dish:0,curtain:0,prepareEat:0,landry:0,special:0}))(data.items.helps),sendingData={...helpsData,person:data.person,comments:data.items.comments};isSetSubmitting("disabled");const res=await post.postHelp(sendingData);if(Number(null===(_res_error=res.error)||void 0===_res_error?void 0:_res_error.code)>=400)return isSetSubmitting("primary"),alert("送信に失敗しました");router.replace("/dashboard")})),children:[(0,jsx_runtime.jsx)(index_esm.xI,{name:"person",control,defaultValue:"",rules:{required:!0},render:({field})=>(0,jsx_runtime.jsxs)("div",{className:"w-80 my-4 m-auto",children:[(0,jsx_runtime.jsx)(Radio.s,{id:"eito",label:"eito",...field,value:"eito"}),(0,jsx_runtime.jsx)(Radio.s,{id:"mei",label:"mei",...field,value:"mei"})]})}),(0,jsx_runtime.jsx)("div",{className:"my-2 m-auto",children:(0,jsx_runtime.jsx)("p",{className:"text-xs text-red-500",children:errors.person&&errors.person.message})}),(0,jsx_runtime.jsxs)("div",{className:"w-80 my-4 m-auto",children:[(0,jsx_runtime.jsx)(index_esm.xI,{name:"items.helps",control,defaultValue:[],rules:{required:!0},render:()=>(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(ErrorBoundary,{fallback:(0,jsx_runtime.jsx)("p",{children:"エラーが発生しました"}),children:(0,jsx_runtime.jsx)(react.Suspense,{fallback:(0,jsx_runtime.jsx)("p",{children:"...Loading"}),children:(0,jsx_runtime.jsx)(PricesList.p,{register:{...register("items.helps")}})})})})}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-red-500",children:(null===(_errors_items=errors.items)||void 0===_errors_items?void 0:_errors_items.helps)&&errors.items.helps.message})]}),(0,jsx_runtime.jsx)(index_esm.xI,{name:"items.comments",control,defaultValue:"",rules:{required:!0},render:({field})=>(0,jsx_runtime.jsx)("div",{className:"w-80 my-4 m-auto",children:(0,jsx_runtime.jsx)(Textarea.T,{id:"textarea",label:"備考",placeholder:"備考があれば入力",...field})})}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-red-500",children:(null===(_errors_items1=errors.items)||void 0===_errors_items1?void 0:_errors_items1.comments)&&errors.items.comments.message}),(0,jsx_runtime.jsx)("div",{className:"w-80 my-4 m-auto",children:(0,jsx_runtime.jsx)(Button.$,{label:"Submit",type:"submit",intent:isSubmitting})})]})})}Page.__docgenInfo={description:"",methods:[],displayName:"Page"};const index_stories={title:"app/feature/Form",component:Page,parameters:{nextjs:{appDirectory:!0,navigation:{pathname:"/form"}}}},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./app/(feature)/form/components/PricesList/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>PricesList});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),Checkbox=__webpack_require__("./app/components/Checkbox/index.tsx"),supabase=__webpack_require__("./app/libs/supabase.ts");__webpack_require__("./node_modules/swr/core/dist/index.mjs");const fetcher=async()=>{try{const fetchSupabase=()=>supabase.N.from("helps_list").select("*, prices_list (*)"),{data,error}=await fetchSupabase();return{data,error}}catch(error){throw new Error(String(error))}},PricesList=({register})=>{const[pricesListRaw,setPricesListRaw]=(0,react.useState)(void 0);(0,react.useEffect)((()=>{(async()=>{const data=await fetcher();setPricesListRaw(data)})()}),[]);const pricesList=(pricesListRaw=>{var _pricesListRaw_data;return(null==pricesListRaw?void 0:pricesListRaw.error)?null:null==pricesListRaw||null===(_pricesListRaw_data=pricesListRaw.data)||void 0===_pricesListRaw_data?void 0:_pricesListRaw_data.map((item=>({id:item.id,label:item.label,column:item.help,value:item.prices_list[0].price})))})(pricesListRaw);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:null==pricesList?void 0:pricesList.map((item=>(0,jsx_runtime.jsx)(Checkbox.S,{label:item.label,id:item.id,...register,value:`${item.column},${item.value}`},item.id)))})};PricesList.__docgenInfo={description:"",methods:[],displayName:"PricesList",props:{register:{required:!0,tsType:{name:"UseFormRegisterReturn",elements:[{name:"literal",value:"'items.helps'"}],raw:"UseFormRegisterReturn<'items.helps'>"},description:""}}}},"./app/components/Button/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>Button});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),__webpack_require__("./app/styles/globals.css");const buttonStyles=(0,__webpack_require__("./node_modules/class-variance-authority/dist/index.mjs").F)("font-bold py-2 px-4 rounded",{variants:{intent:{primary:"bg-blue-500 hover:bg-blue-700 text-white ",secondary:"bg-transparent hover:bg-blue-500 text-blue-700 border border-blue-500 hover:border-transparent",disabled:"bg-blue-500 text-white opacity-50 cursor-not-allowed text-white "}},defaultVariants:{intent:"primary"}}),Button=({label,type,intent,onClick})=>(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{className:buttonStyles({intent}),type,disabled:"disabled"===intent||!1,onClick,children:label})});Button.__docgenInfo={description:"",methods:[],displayName:"Button",props:{label:{required:!0,tsType:{name:"string"},description:""},type:{required:!0,tsType:{name:"union",raw:"'submit' | 'reset' | 'button'",elements:[{name:"literal",value:"'submit'"},{name:"literal",value:"'reset'"},{name:"literal",value:"'button'"}]},description:""},intent:{required:!0,tsType:{name:"union",raw:"'primary' | 'secondary' | 'disabled'",elements:[{name:"literal",value:"'primary'"},{name:"literal",value:"'secondary'"},{name:"literal",value:"'disabled'"}]},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}}},"./app/components/Checkbox/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>Checkbox});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./app/styles/globals.css");const checkboxStyles_container="flex items-center ps-4 border border-gray-200 rounded dark:border-gray-700",checkboxStyles_label="w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",checkboxStyles_checkbox="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",Checkbox=(0,react.forwardRef)((({id,label,value,...rest},ref)=>(0,jsx_runtime.jsxs)("div",{className:checkboxStyles_container,children:[(0,jsx_runtime.jsx)("input",{...rest,type:"checkbox",id,className:checkboxStyles_checkbox,value,ref}),(0,jsx_runtime.jsx)("label",{htmlFor:id,className:checkboxStyles_label,children:label})]})));Checkbox.__docgenInfo={description:"",methods:[],displayName:"Checkbox",props:{id:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"string"},description:""},ref:{required:!0,tsType:{name:"Ref",elements:[{name:"HTMLInputElement"}],raw:"Ref<HTMLInputElement>"},description:""}}}},"./app/components/Radio/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>Radio});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./app/styles/globals.css");const radioStyles_container="flex items-center ps-4 border border-gray-200 rounded dark:border-gray-700",radioStyles_label="w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",radioStyles_radio="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",Radio=(0,react.forwardRef)((({id,label,value,...field},_ref)=>(0,jsx_runtime.jsxs)("div",{className:radioStyles_container,children:[(0,jsx_runtime.jsx)("input",{...field,type:"radio",id,className:radioStyles_radio,value}),(0,jsx_runtime.jsx)("label",{htmlFor:id,className:radioStyles_label,children:label})]})));Radio.__docgenInfo={description:"",methods:[],displayName:"Radio",props:{id:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"string"},description:""}}}},"./app/components/Textarea/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>Textarea});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./app/styles/globals.css");const textareaStyles_label="block mb-2 text-sm font-medium text-gray-900 dark:text-white",textareaStyles_textarea="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",Textarea=(0,react.forwardRef)((({label,id,placeholder,...field},_ref)=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{htmlFor:id,className:textareaStyles_label,children:label}),(0,jsx_runtime.jsx)("textarea",{...field,id,className:textareaStyles_textarea,placeholder})]})));Textarea.__docgenInfo={description:"",methods:[],displayName:"Textarea",props:{label:{required:!0,tsType:{name:"string"},description:""},id:{required:!0,tsType:{name:"string"},description:""},placeholder:{required:!0,tsType:{name:"string"},description:""}}}},"./app/libs/supabase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>supabase});const supabase=(0,__webpack_require__("./node_modules/@supabase/ssr/dist/index.mjs").kT)("https://nwfyqjvaavytozjxbghx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53ZnlxanZhYXZ5dG96anhiZ2h4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDY3OTIwMDMsImV4cCI6MjAyMjM2ODAwM30.nLMw7c0_Rucxzova6KJAiS9BdsLMyO4LGawzpaPahFc")}}]);